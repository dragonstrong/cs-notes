# 1.渲染二级三级分类数据
对应视频p138
需求：获取如下结构数据
一级分类列表中每个一级分类包含二级子分类列表，每个二级子分类包含三级子分类列表
![image.png](https://cdn.nlark.com/yuque/0/2024/png/34372585/1711375864856-04ea2ed2-01d4-4388-a109-c14d4d2641c0.png#averageHue=%23fefefd&clientId=u9a098ef6-77f0-4&from=paste&height=866&id=u4497286f&originHeight=866&originWidth=395&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25265&status=done&style=none&taskId=u6ffa2efc-25ee-4273-8666-e1a30aa16dc&title=&width=395)

```java
public Map<String, List<Catalog2Vo>> getCatalogJson(){
    Map<String, List<Catalog2Vo>> map=null;  // 结果
    // 找一级分类
    List<CategoryEntity> categoryEntityList=getBaseMapper().selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid",0));
    if (categoryEntityList!=null){
        // 对每一个一级分类找二级分类
        // 封装成map   key=一级分类的catId  value=List<Catalog2Vo>
        map=categoryEntityList.stream().collect(Collectors.toMap(k->{
            return k.getCatId().toString();
        },v->{
            // 找v的二级分类列表
            List<Catalog2Vo> catalog2VoList=null;
            List<CategoryEntity> category2Entities=getBaseMapper().selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid",v.getCatId()));
            if (category2Entities!=null){
                // 将category2Entities封装成List<Catalog2Vo>
                // 先找3级子分类列表
                catalog2VoList=category2Entities.stream().map(l2->{
                    List<CategoryEntity> category3Entities=getBaseMapper().selectList(new QueryWrapper<CategoryEntity>().eq("parent_cid",l2.getCatId()));
                    List<Catalog2Vo.Category3Vo> category3VoList=null;
                    if (category3Entities!=null){
                        category3VoList=category3Entities.stream().map(l3->{
                            Catalog2Vo.Category3Vo catalog3Vo=new Catalog2Vo.Category3Vo(l2.getCatId().toString(),l3.getCatId().toString(),l3.getName());
                            return catalog3Vo;
                        }).collect(Collectors.toList());
                    }
                    Catalog2Vo catalog2Vo=new Catalog2Vo(l2.getParentCid().toString(),category3VoList,l2.getCatId().toString(),l2.getName());
                    return catalog2Vo;
                }).collect(Collectors.toList());
            }
            return catalog2VoList;
        }));
    }
    return map;
}
```
![image.png](https://cdn.nlark.com/yuque/0/2024/png/34372585/1711375992991-73b8858e-2a86-4c6e-80fc-8cb175030fbf.png#averageHue=%23fcfbf9&clientId=u9a098ef6-77f0-4&from=paste&height=443&id=u7aa53b52&originHeight=443&originWidth=277&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20199&status=done&style=none&taskId=ua5dc3986-3f85-4a5d-8c8b-87910f7cd46&title=&width=277)





## 1.2 逻辑删除

参考：https://baomidou.com/guides/logic-delete/

(1) 配置全局逻辑删除规则

```yaml
mybatis-plus:
  global-config:
    db-config:
      logic-delete-value: 1 # 配置全局逻辑删除规则
      logic-not-delete-value: 0
```

(2)对数据库表中想要作为逻辑删除的字段加**@TableLogic**注解

```java
@Data
@TableName("pms_category")
public class CategoryEntity implements Serializable {
    /**
	 * 是否显示[0-不显示，1显示] ,@TableLogic逻辑删除注解,  若与全局配置相反直接用value deval注明
	 */
	@TableLogic(value = "1",delval = "0")
	private Integer showStatus;
}
```

(3)直接用BaseMapper里的deleteBatchIds

```java
@Override
public void removeMenuByIds(List<Long> asList) {
    // TODO 检查删除菜单是否被引用
    // 逻辑删除
    baseMapper.deleteBatchIds(asList);
}
```



测试：逻辑删除cat_id为988的数据后

![image-20240825204339507](assets/image-20240825204339507.png)
